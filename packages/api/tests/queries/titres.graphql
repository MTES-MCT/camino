query Titres(
  $domainesIds: [ID!]
  $typesIds: [ID!]
  $statutsIds: [ID!]
  $substancesIds: String
  $noms: String
  $entreprises: String
  $references: String
  $territoires: String
) {
  titres(
    domainesIds: $domainesIds
    typesIds: $typesIds
    statutsIds: $statutsIds
    substancesIds: $substancesIds
    noms: $noms
    entreprises: $entreprises
    references: $references
    territoires: $territoires
  ) {
    total
    elements {
      ...titre
    }
  }
}

fragment titre on Titre {
  id
  nom
  type {
    id
    type {
      id
      nom
    }
  }
  domaine {
    id
    nom
  }
  titreStatutId
  references {
    ...reference
  }
  surface
  substances
  administrations {
    ...administration
  }
  titulaires {
    ...entreprise
  }
  amodiataires {
    ...entreprise
  }
  points {
    ...point
  }
  geojsonPoints {
    ...geojsonPoints
  }
  geojsonMultiPolygon {
    ...geojsonMultiPolygon
  }
  demarches {
    ...demarche
  }
}

fragment demarche on Demarche {
  id
  ordre
  type {
    id
    nom
  }
  statutId
  phase {
    dateDebut
    dateFin
    statut {
      id
      nom
      couleur
    }
  }
  etapes {
    ...etape
  }
}

fragment etape on Etape {
  id
  ordre
  date
  duree
  surface
  type {
    id
    nom
  }
  statutId
  substances
  administrations {
    ...administration
  }
  titulaires {
    ...entreprise
  }
  amodiataires {
    ...entreprise
  }
  points {
    ...point
  }
  geojsonPoints {
    ...geojsonPoints
  }
  geojsonMultiPolygon {
    ...geojsonMultiPolygon
  }
  documents {
    ...document
  }
}

fragment administration on Administration {
  id
  nom
  service
  adresse1
  adresse2
  codePostal
  commune
  cedex
  url
  telephone
  email
  utilisateurs {
    ...utilisateur
  }
}

fragment entreprise on Entreprise {
  id
  nom
  etablissements {
    id
    nom
    dateDebut
    dateFin
    legalSiret
  }
  paysId
  legalSiren
  legalEtranger
  legalForme
  categorie
  adresse
  codePostal
  commune
  cedex
  url
  telephone
  email
  utilisateurs {
    ...utilisateur
  }
}

fragment utilisateur on Utilisateur {
  id
  email
  nom
  prenom
  telephoneMobile
  telephoneFixe
  role
}

fragment point on Point {
  id
  coordonnees {
    x
    y
  }
  groupe
  contour
  point
  nom
  description
  securite
  references {
    ...pointReference
  }
}

fragment pointReference on PointReference {
  id
  geoSystemeId
  coordonnees {
    x
    y
  }
}

fragment geojsonMultiPolygon on GeojsonMultiPolygon {
  type
  geometry {
    type
    coordinates
  }
}

fragment geojsonPoints on GeojsonPoints {
  type
  features {
    type
    geometry {
      type
      coordinates
    }
  }
}

fragment document on Document {
  id
  type {
    id
  }
  url
  uri
  fichier
  jorf
  nor
}

fragment reference on Reference {
  type {
    ...referenceType
  }
  nom
}

fragment referenceType on ReferenceType {
  id
  nom
}
