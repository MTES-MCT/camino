name: Graphql
on:
  workflow_call:
jobs:
  test:
    name: check-schema
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@master
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '19.1'
          cache: 'npm'
      - name: Graphql inspector
        run : |
          npm i --global @graphql-inspector/ci @graphql-inspector/validate-command @graphql-inspector/graphql-loader @graphql-inspector/code-loader graphql
          graphql-inspector validate --noStrictFragments packages/ui/src/api packages/api/src/api/graphql/schemas/index.graphql
          for f in packages/api/tests/queries/*.graphql
          do
            graphql-inspector validate --noStrictFragments "$f" packages/api/src/api/graphql/schemas/index.graphql
          done
          
